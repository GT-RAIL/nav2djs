var NAV2D=NAV2D||{REVISION:"1"};NAV2D.Navigator=function(m){var h=this;var m=m||{};var d=m.ros;var a=m.serverName||"/move_base";var j=m.actionName||"move_base_msgs/MoveBaseAction";this.rootObject=m.rootObject||new createjs.Container();var c=new ROSLIB.ActionClient({ros:d,actionName:j,serverName:a});var g=function(q){var o=new ROSLIB.Goal({actionClient:c,goalMessage:{target_pose:{header:{frame_id:"/map"},pose:q}}});o.send();var n=new ROS2D.NavigationArrow({size:8,strokeSize:1,fillColor:createjs.Graphics.getRGB(255,64,128,0.66)});n.x=q.position.x;n.y=-q.position.y;n.rotation=i.rosQuaternionToGlobalTheta(q.orientation);n.scaleX=1/i.scaleX;n.scaleY=1/i.scaleY;h.rootObject.addChild(n);var p=0;var r=true;createjs.Ticker.addEventListener("tick",function(){if(r){n.scaleX*=1.035;n.scaleY*=1.035;r=(++p<10)}else{n.scaleX/=1.035;n.scaleY/=1.035;r=(--p<0)}});o.on("result",function(){h.rootObject.removeChild(n)})};if(h.rootObject instanceof createjs.Stage){var i=h.rootObject}else{var i=h.rootObject.getStage()}var k=new ROS2D.NavigationArrow({size:12,strokeSize:1,fillColor:createjs.Graphics.getRGB(255,128,0,0.66)});k.visible=false;this.rootObject.addChild(k);var b=false;var e=0;var f=true;createjs.Ticker.addEventListener("tick",function(){if(b){if(f){k.scaleX*=1.035;k.scaleY*=1.035;f=(++e<10)}else{k.scaleX/=1.035;k.scaleY/=1.035;f=(--e<0)}}});var l=new ROSLIB.Topic({ros:d,name:"/robot_pose",messageType:"geometry_msgs/Pose",throttle_rate:100});l.subscribe(function(n){k.x=n.position.x;k.y=-n.position.y;if(!b){k.scaleX=1/i.scaleX;k.scaleY=1/i.scaleY;b=true}k.rotation=i.rosQuaternionToGlobalTheta(n.orientation);k.visible=true});this.rootObject.addEventListener("dblclick",function(n){var o=i.globalToRos(n.stageX,n.stageY);var p=new ROSLIB.Pose({position:new ROSLIB.Vector3(o)});g(p)})};NAV2D.OccupancyGridClientNav=function(c){var d=this;var c=c||{};this.ros=c.ros;var b=c.topic||"/map";var e=c.continuous;this.serverName=c.serverName||"/move_base";this.actionName=c.actionName||"move_base_msgs/MoveBaseAction";this.rootObject=c.rootObject||new createjs.Container();this.viewer=c.viewer;this.navigator=null;var a=new ROS2D.OccupancyGridClient({ros:this.ros,rootObject:this.rootObject,continuous:e});a.on("change",function(){d.navigator=new NAV2D.Navigator({ros:d.ros,serverName:d.serverName,actionName:d.actionName,rootObject:d.rootObject});d.viewer.scaleToDimensions(a.currentGrid.width,a.currentGrid.height)})};