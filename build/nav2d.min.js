var NAV2D=NAV2D||{REVISION:"2-devel"};NAV2D.Navigator=function(e){function o(e){var o=new ROSLIB.Goal({actionClient:n,goalMessage:{target_pose:{header:{frame_id:"/map"},pose:e}}});o.send();var r=new ROS2D.NavigationArrow({size:8,strokeSize:1,fillColor:createjs.Graphics.getRGB(255,64,128,.66),pulse:!0});r.x=e.position.x,r.y=-e.position.y,r.rotation=s.rosQuaternionToGlobalTheta(e.orientation),r.scaleX=1/s.scaleX,r.scaleY=1/s.scaleY,t.rootObject.addChild(r),o.on("result",function(){t.rootObject.removeChild(r)})}var t=this;e=e||{};var r=e.ros,i=e.serverName||"/move_base",a=e.actionName||"move_base_msgs/MoveBaseAction";this.rootObject=e.rootObject||new createjs.Container;var s,n=new ROSLIB.ActionClient({ros:r,actionName:a,serverName:i});s=t.rootObject instanceof createjs.Stage?t.rootObject:t.rootObject.getStage();var c=new ROS2D.NavigationArrow({size:12,strokeSize:1,fillColor:createjs.Graphics.getRGB(255,128,0,.66),pulse:!0});c.visible=!1,this.rootObject.addChild(c);var l=!1,v=new ROSLIB.Topic({ros:r,name:"/robot_pose",messageType:"geometry_msgs/Pose",throttle_rate:100});v.subscribe(function(e){c.x=e.position.x,c.y=-e.position.y,l||(c.scaleX=1/s.scaleX,c.scaleY=1/s.scaleY,l=!0),c.rotation=s.rosQuaternionToGlobalTheta(e.orientation),c.visible=!0}),this.rootObject.addEventListener("dblclick",function(e){var t=s.globalToRos(e.stageX,e.stageY),r=new ROSLIB.Pose({position:new ROSLIB.Vector3(t)});o(r)})},NAV2D.OccupancyGridClientNav=function(e){var o=this;e=e||{},this.ros=e.ros;var t=e.topic||"/map",r=e.continuous;this.serverName=e.serverName||"/move_base",this.actionName=e.actionName||"move_base_msgs/MoveBaseAction",this.rootObject=e.rootObject||new createjs.Container,this.viewer=e.viewer,this.navigator=null;var i=new ROS2D.OccupancyGridClient({ros:this.ros,rootObject:this.rootObject,continuous:r,topic:t});i.on("change",function(){o.navigator=new NAV2D.Navigator({ros:o.ros,serverName:o.serverName,actionName:o.actionName,rootObject:o.rootObject}),o.viewer.shift(i.currentGrid.pose.position.x,i.currentGrid.pose.position.y),o.viewer.scaleToDimensions(i.currentGrid.width,i.currentGrid.height)})};