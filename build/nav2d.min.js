var NAV2D=NAV2D||{REVISION:"2-devel"};NAV2D.Navigator=function(e){function o(e){var o=new ROSLIB.Goal({actionClient:n,goalMessage:{target_pose:{header:{frame_id:"/map"},pose:e}}});o.send();var a=new ROS2D.NavigationArrow({size:8,strokeSize:1,fillColor:createjs.Graphics.getRGB(255,64,128,.66),pulse:!0});a.x=e.position.x,a.y=-e.position.y,a.rotation=s.rosQuaternionToGlobalTheta(e.orientation),a.scaleX=1/s.scaleX,a.scaleY=1/s.scaleY,t.rootObject.addChild(a),o.on("result",function(){t.rootObject.removeChild(a)})}var t=this;e=e||{};var a=e.ros,r=e.serverName||"/move_base",i=e.actionName||"move_base_msgs/MoveBaseAction";this.rootObject=e.rootObject||new createjs.Container;var s,n=new ROSLIB.ActionClient({ros:a,actionName:i,serverName:r});s=t.rootObject instanceof createjs.Stage?t.rootObject:t.rootObject.getStage();var c=new ROS2D.NavigationArrow({size:12,strokeSize:1,fillColor:createjs.Graphics.getRGB(255,128,0,.66),pulse:!0});c.visible=!1,this.rootObject.addChild(c);var l=!1,v=new ROSLIB.Topic({ros:a,name:"/robot_pose",messageType:"geometry_msgs/Pose",throttle_rate:100});v.subscribe(function(e){c.x=e.position.x,c.y=-e.position.y,l||(c.scaleX=1/s.scaleX,c.scaleY=1/s.scaleY,l=!0),c.rotation=s.rosQuaternionToGlobalTheta(e.orientation),c.visible=!0}),this.rootObject.addEventListener("dblclick",function(e){var t=s.globalToRos(e.stageX,e.stageY),a=new ROSLIB.Pose({position:new ROSLIB.Vector3(t)});o(a)})},NAV2D.OccupancyGridClientNav=function(e){var o=this;e=e||{},this.ros=e.ros,e.topic||"/map";var t=e.continuous;this.serverName=e.serverName||"/move_base",this.actionName=e.actionName||"move_base_msgs/MoveBaseAction",this.rootObject=e.rootObject||new createjs.Container,this.viewer=e.viewer,this.navigator=null;var a=new ROS2D.OccupancyGridClient({ros:this.ros,rootObject:this.rootObject,continuous:t});a.on("change",function(){o.navigator=new NAV2D.Navigator({ros:o.ros,serverName:o.serverName,actionName:o.actionName,rootObject:o.rootObject}),o.viewer.scaleToDimensions(a.currentGrid.width,a.currentGrid.height)})};